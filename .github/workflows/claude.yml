name: Claude Code Review

on:
  pull_request:
    types: [opened, synchronize, reopened]
  issue_comment:
    types: [created]

jobs:
  claude-review:
    if: |
      (github.event_name == 'pull_request' && github.event.action == 'opened') ||
      (github.event_name == 'issue_comment' && github.event.issue.pull_request)
    permissions:
      contents: read
      pull-requests: write
      issues: write
      id-token: write
    uses: alliance-genome/.github/.github/workflows/claude-code-review.yml@main
    with:
      model: claude-sonnet-4-20250514
      max_turns: "30"
      review_focus: "plugin marketplace structure, version consistency between marketplace.json and plugin.json files, YAML frontmatter in skills, and compliance with Claude Code plugin conventions. CRITICAL: Check that every plugin version in .claude-plugin/marketplace.json matches the version in the corresponding plugins/*/.claude-plugin/plugin.json. If a plugin's skills or agents were modified, its version MUST be incremented. Report any version mismatches as a blocking issue."
      trigger_phrase: "@claude"
    secrets:
      ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
